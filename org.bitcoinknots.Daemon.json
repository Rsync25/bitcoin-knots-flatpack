{
  "app-id": "org.bitcoinknots.Daemon",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "22.08",
  "sdk": "org.freedesktop.Sdk",
  "sdk-extensions": ["org.freedesktop.Sdk.Extension.llvm16"],
  "command": "bitcoin-knots-daemon",
  "finish-args": [
    "--share=network",
    "--socket=network",
    "--filesystem=home:ro",
    "--filesystem=xdg-data/bitcoin-knots:create",
    "--talk-name=org.freedesktop.DBus",
    "--env=BITCOIN_DATA_DIR=/home/user/.bitcoin",
    "--allow=devel"
  ],
  "modules": [
    {
      "name": "berkeley-db",
      "buildsystem": "simple",
      "build-commands": [
        "cd build_unix",
        "../dist/configure --prefix=/app --disable-shared --enable-cxx --disable-replication --with-pic",
        "make -j$(nproc)",
        "make install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz",
          "sha256": "12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef"
        }
      ]
    },
    {
      "name": "bitcoin-knots",
      "buildsystem": "autotools",
      "build-options": {
        "env": {
          "CPPFLAGS": "-I/app/include -I/app/include/db4.8",
          "LDFLAGS": "-L/app/lib -L/app/lib/db4.8",
          "BDB_CFLAGS": "-I/app/include/db4.8",
          "BDB_LIBS": "-L/app/lib/db4.8 -ldb_cxx-4.8"
        }
      },
      "config-opts": [
        "--disable-gui",
        "--disable-wallet",
        "--disable-bench",
        "--disable-tests",
        "--disable-man",
        "--with-boost=/usr",
        "--with-boost-libdir=/usr/lib64",
        "--with-libevent=/usr"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/bitcoinknots/bitcoin.git",
          "tag": "v29.1.knots20250903"
        }
      ]
    },
    {
      "name": "bitcoin-knots-wrapper",
      "buildsystem": "simple",
      "build-commands": [
        "install -Dm755 bitcoin-knots-daemon.sh /app/bin/bitcoin-knots-daemon"
      ],
      "sources": [
        {
          "type": "file",
          "path": "bitcoin-knots-daemon.sh"
        }
      ]
    }
  ]
}